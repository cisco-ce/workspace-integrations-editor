<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manifest editor</title>
  <link rel="stylesheet" href="./assets/style.css"></link>
  <script src="src/scopes.js" defer></script>
  <script src="src/main.js" defer></script>
  <script src="./src/alpine.js" defer></script>
</head>
<body
  x-cloak
  x-data="model"
>
<header>
  <h1 @click="home()">Workspace Integrations</h1>
  <h2 @click="home()">Manifest Editor</h2>
</header>

<main x-show="!config" class="start-page">
  <div>
    Create new manifest or import existing from file.
  </div>
  <div>
    You can drag and drop a manifest file here too.
  </div>
  <div class="buttons">
    <button @click="createNew()">Create new</button>
    <input
      class="manifest-file"
      accept=".json"
      type="file"
      @change="loadFromFile($event.target.files)"
    />
    <button @click="document.querySelector('.manifest-file').click()">Load file...</button>
    <button @click="loadSample()">Load sample</button>
  </div>
</main>


<main x-show="!!config">
  <div>
    For detailed help, see the <a href="https://developer.webex.com/docs/api/guides/workspace-integrations-guide" target="_blank">Workspace Integrations Guide</a> on developer.webex.com.
  </div>
  <div x-show="showJson">
    <textarea
      class="raw-json"
      :value="JSON.stringify(config, null, 2)"
    ></textarea>
    <div class="buttons">
      <button
        @click="setJson(document.querySelector('.raw-json').value)"
        x-show="showJson"
      >Show UI</button>
    </div>

  </div>
  <div x-show="!showJson">
    <template x-for="input in form">
      <section>
        <label
          :for="input.id"
          x-text="input.name"
          :class="input.required ? 'required' : ''"
        ></label>
        <template x-if="input.type === 'string'">
          <input
            :id="input.id"
            x-model="input.container[input.id]"
            :type="input.valuespace || 'text'"
            :placeholder="input.placeholder || ''"
          />
        </template>
        <template x-if="input.type === 'text'">
          <textarea
            :id="input.id"
            x-model="input.container[input.id]"
            :type="input.valuespace || 'text'"
            :placeholder="input.placeholder || ''"
          ></textarea>
        </template>
        <template x-if="input.type === 'select'">
          <select x-model="input.container[input.id]">
            <template x-for="value in input.values">
              <!-- :selected is also needed because x-model is run before x-for -->
              <option
                :value="value"
                :selected="value === input.container[input.id]"
                x-text="value"
              ></option>
            </template>
          </select>
        </template>
        <template x-if="input.type === 'list'">
          <div class="list">
            <template x-if="input.values.length < 1">
              <div>
                <i>List is empty.</i>
              </div>
            </template>
            <template x-for="item, i in input.values">
              <div>
                <input
                  x-model="item.container[item.id]"
                  :list="input.datalist"
                  :placeholder="input.placeholder || ''"
                />
                <button @click="input.remove(i)" class="remove">X</button>
                <a
                  :href="item.url"
                  x-show="!!item.url"
                  target="_blank"
                >Doc</a>
              </div>
            </template>
            <div class="buttons">
              <button @click="input.add()">Add</button>
            </div>
          </div>
        </template>
        <div class="warning" x-show="input.warning" x-text="input.warning"></div>
        <div class="error" x-show="input.error" x-text="input.error"></div>
      </div>
    </template>
  </section>
  <div class="buttons">
    <button @click="saveToFile()" class="primary">Save file</button>
    <button @click="toClipboard()">To clipboard</button>
    <button @click="showJson = true;" x-show="!showJson">Raw JSON</button>
    <button @click="validateManifest()">Validate</button>
  </div>
</main>

<template x-for="datalist in datalists">
  <datalist :id="datalist.id">
    <template x-for="value in datalist.values">
      <option :value="value">
    </template>
  </datalist>
</template>

</body>

</html>